language: python

python:
  - 3.5

addons:
  apt:
    packages:
      - pyqt5-dev-tools

git:
  submodules: false

before_install:
  - >-
    openssl aes-256-cbc
    -K $encrypted_0b023fb27a48_key
    -iv $encrypted_0b023fb27a48_iv
    -in github_deploy_key.enc
    -out github_deploy_key
    -d
  - chmod 600 github_deploy_key
  - eval $(ssh-agent -s)
  - ssh-add github_deploy_key
  - git submodule update --init --recursive

install:
  - pip install -r requirements.txt


jobs:
  include:
    - stage: deploy
      if: tag IS present
      script: plugin_ci/release/release.sh

    - stage: deploy
      if: branch = master
      script: plugin_ci/translate/update-translations.sh

env:
  global:
    # OSGEO credentials to release the plugin
    # Generate with the following command for proper special characters support
    # travis encrypt OSGEO_PASSWORD=\''Your super secret password!'\'
    - OSGEO_USERNAME=3nids
    secure: "GqUZb8/RhJwicRk/HU56RvDR/LmENqSQt9wf45wPUkkDAoI0RWueffcfLuVZiSCVIvo2IGeSjm9e3Ke67+QeTzxzZcoZpU1WxpuPaLfRYjO4YZipkTK8ksgJ9Pv/easdmYLUiRJQbm0a4eZITMqENkVeqRy7f8ysa7aSf8Uext1nvKbUSJJJn4Qy/+ue3u1d3BB7MNtFbmne6xHuzkLnxlZV+kQdZbkGl3u+BKSC6RFf4EXMaZlbRYmiIR3JO/Z/f+pvtit6F87lGYqxlPX+oOaQaALGSoG6gU9o/3VIn0ZG/zGSr81JCpSS8qGetzN1lXSkmgp5ult7Kqu+wCZewoCZbv2zO7nvySOu2HXy3Qk9UtQs4nPJuM5Pm0dqml4dsKXOn9CK8JKLliGzTY9MUbmLzoVhBfVlxQ5o/VbDvjlhCj9pO3Fnrot0WvIWq3T2P+7VaYTjW3cA9gMKTCSqANG8D+da1FKTD1qpcgilO6tBeTVfbjig61xt8cnalKvNmGI7WwUEPJDqUMCGyW1uI4XTWyY6IsNfeJSYXssqWKt7x4koNK8QwwqFGyphfjpHU50K7EzHk0ko591FKsWjVuqNDmrCyrEZCRQYIH42kHtvih6TqWdAVDEr57kgfHhCC+zTK8YwDfcylHEsUqrt9yt8nxL1uMqlLDPvbKHkfEU="

    # TRANSIFEX_API_TOKEN, generated on Transifex website
    # travis encrypt TX_TOKEN="......"
    - secure: "BWqMLP66AkFIrPxFOH1MxiMjLctpo6ZZYCwY3/eTumZ1eP/+YC0uKQduIJUKIqLtXNVaH8YGs2VfpFUD0QguAOvsk0fnR90qWZPwS+cAecq0MwnvmmrQk3/P0xBqaDGtE6G4OF4eKyB10ZohHEHE3BIMhiZkZvZAJ8ngNGYU6dL1l1kTBPXj0wucE17RAn9MIzr7YbO16WmkPEl2nEhjh9+2S0bv1nqp1Z2we4kjCQk9TvrvxCrY+Ow037HKgxfTQd0GU2WLJPmzc9Jf1bikf4Cdx6KusyVhI2u2GeMElQZhkVacgy8iuzf9DQGRLOx/1XMcv+jlWexgcADE/oGsBAcejByUAIs4nc4Sj/rcE2I8G6UTAd/dKMktWgTmTO0KhICJLKksbGYhZ9nP9TTWeL99vJTH2HlQMUcn8UHhQLv0bo4SoA8gKGgKajRs8LKPZ//hhxicSlMhPKxO8k2nwUhZJsGFsTZQTZtvErXUPFZhmWwfoYWS4rfIw4Sl0WqlgsN3PHJanmuQUCulIkVOz3O7iE9gNtflCrp/amfwe2leQ+85mbVGmNAEWn4qcMpqK+cnsepRCRO5Qj0Wkfitw+pFk4oTptcyFwyqF3ItWOgrr866ULIU3D4Uk1M6+xMz2Q328SCbBrm4n/sQM3bwE53QQ4bQUWr0S8S8RrKdpdY="

    # GH_TOKEN for creating releases
    # https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line
    # authrize only "repo_deployment"
    # travis encrypt GH_TOKEN="......"
    - secure: "iuZBbgpoLu28gJrx0tEiwiwee+k0yGxPi710xGkj2lFolyxOnOGQGw+Kf67MXfZTYjifPtpXepwebvL4NJAf576zgjM2TZaMJmi0mnl8GPaHC1wkJqXzb0djraK7ru/b4IVxoCo76abn9JbOrQB1pXZf9P/ig1d97pp4O/hNTRItnwTsufOQIGSeHGJTkq+dGJUs58VsVqRDdmaZRnm2+YYUNSb7ED+OaktriyCp5J2ex9aiK/DnvtXuE3FvGd6lKS5iDkms5L/IY8vZT+snXgUvphWysG6YDcR3G/tOljab+PMPDEqIq8G6wj6CPJFKfiCm+5RU+Ak0H7KWEcoT6tPI7sv2W2WBGcruMJJRU0s/LnuztfXJNfiP52yfGlF8jqKKRnDQnESWf/zGz0NpVGXUAVx5CB46qTLTfoqwU+SEuwAsllb9RFc3UbblQ2YqylyoN25PegDUJNsASK/uHUqEHroFH1kCOT2/1ofvatP4CQEFSmkOmVdxQJo2gNTazWp+hc0LkDyvuyrXnkPrkelg7XrOQ9fdBNxLd2gDwZM8eXVO/ui475jnVNkhR/RWgknaiK8GBaexrftVITXgXo05Wb5Ors4q79xC694bkT4kcV1OW9bk1u1SnW8maKQngoWhjf+0DDtw3StxdFN1saK9K4ASW44sZbZji8q99Mc="
